# SSL/TLS настройка для Analytics микросервиса

## Обзор

Этот каталог содержит SSL/TLS сертификаты, используемые для обеспечения шифрованного соединения (HTTPS) в микросервисе Analytics. В соответствии с архитектурным документом проекта QA-4-Free, все микросервисы должны поддерживать безопасное соединение через HTTPS.

## Структура файлов

- `private-key.pem` - приватный ключ для SSL/TLS
- `certificate.pem` - SSL/TLS сертификат
- `ca.pem` - сертификат центра сертификации (при использовании самоподписанных сертификатов)
- `generate-certs.js` - скрипт для генерации самоподписанных сертификатов для разработки

## Настройка для разработки

Для локальной разработки вы можете использовать самоподписанные сертификаты. Выполните следующие шаги:

1. Убедитесь, что у вас установлен OpenSSL:
   - Windows: можно установить через [Chocolatey](https://chocolatey.org/): `choco install openssl`
   - Linux: `sudo apt-get install openssl`
   - macOS: `brew install openssl`

2. Запустите скрипт для генерации сертификатов:
   ```
   node generate-certs.js
   ```

3. Установите сгенерированный CA сертификат в доверенные центры сертификации вашей операционной системы (инструкции предоставляются после выполнения скрипта).

## Настройка для продакшена

В рабочей среде следует использовать сертификаты, выданные доверенным центром сертификации (например, Let's Encrypt, DigiCert и т.д.). После получения сертификатов:

1. Поместите их в этот каталог с соответствующими именами:
   - Приватный ключ: `private-key.pem`
   - Сертификат: `certificate.pem`
   - CA сертификат (если требуется): `ca.pem`

2. Убедитесь, что права доступа к файлам настроены правильно:
   - Приватный ключ должен быть доступен только для чтения владельцем процесса сервера
   - Другие файлы могут быть доступны для чтения всем пользователям

## Конфигурация через переменные окружения

Микросервис поддерживает следующие переменные окружения для настройки SSL:

- `SSL_KEY_PATH` - путь к файлу приватного ключа
- `SSL_CERT_PATH` - путь к файлу сертификата
- `SSL_CA_PATH` - путь к файлу CA сертификата (опционально)

Если эти переменные не указаны, используются файлы по умолчанию из этого каталога.

## Безопасность

- Никогда не включайте настоящие приватные ключи или сертификаты в систему контроля версий
- Используйте `.gitignore` для исключения файлов `.pem` из репозитория
- В рабочей среде рассмотрите возможность хранения сертификатов в безопасном хранилище секретов

## Проверка настройки HTTPS

Чтобы проверить, работает ли сервис по HTTPS:

1. Запустите сервис с правильной конфигурацией SSL
2. Проверьте подключение через браузер или с помощью curl:
   ```
   curl https://localhost:3105/health -k
   ```
   Флаг `-k` используется для игнорирования проверки сертификата (полезно для самоподписанных сертификатов).
