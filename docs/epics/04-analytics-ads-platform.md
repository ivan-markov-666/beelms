# Епик: Платформа за анализи и рекламна монетизация

## Бизнес цел
Да генерираме стойност от потребителското взаимодействие чрез събиране на телеметрични данни за подобряване на продукта и интеграция на реклами с anti-adblocker стратегии за монетизация. Надеждните анализи подпомагат вземането на решения, а рекламите осигуряват допълнителен приход за поддръжка и развитие на LMS.

## Метрики за успех / KPI
- Успешно регистрирани телеметрични събития ≥ **90 %**
- Успешно показване на реклама въпреки ad-block ≥ **95 %**
- Средно време за зареждане на реклама ≤ **500 ms**
- CTR (Click-Through Rate) на реклами ≥ **1 %**
- Време за генериране на дашборд ≤ **2 s**
- Критични WCAG 2.1 AA accessibility issues = **0** (рекламни банери и аналитичен dashboard)

## Основни изисквания
- **Telemetry Service**
  - API за изпращане на събития (page view, video play, quiz submit)
  - Batch съхранение в timeseries/PostgreSQL таблици
  - Idempotency ключове за избягване на дублиране
- **Analytics Dashboard**
  - Grafana/Redash dev setup с готови панели (engagement, completion rate) с проверка за WCAG AA контраст в цветни схеми
  - CSV/JSON експорт на сурови данни
- **Ads Service**
  - Сървър-рендерирани реклами (HTML + CSS) без ключови „ad“ думи, съблюдавайки WCAG AA контраст и alt текстове
  - Вградени Base64 изображения, динамични CSS класове за bypass
  - API за кампании, импресии и кликове
- **Anti-Adblocker Стратегии**
  - Проверка за блокиращи скриптове и fallback към альтернативни delivery методи
  - A/B тестване на bypass техники
- **Сигурност и съответствие**
  - GDPR уведомление за tracking cookies / реклами
  - Rate limiting на ad impression API
- **Тестове и наблюдаемост**
  - Unit + integration тестове (>90 % покритие)
  - Логиране на импресии, кликове, telemetry errors → console dev

## Извън обхвата
- Real-time персонализирано препоръчване на съдържание
- Динамично ценообразуване на реклами (RTB)
- Data warehouse извън PostgreSQL (напр. BigQuery)

## Зависимости
- Завършени епики 1, 2 и 3 (идентификация на потребител, съдържание и тестове)
- Postgres + Redis; Docker-compose за локална среда
- Grafana/Redash docker images (безплатен self-host dev)
- CI pipeline за тестове и линт

## Рискове и смекчаване
| Риск | Въздействие | Вероятност | Митигиране |
|------|-------------|------------|------------|
| Промени в adblock алгоритмите | Високо | Високо | Наблюдаване на adblock списъци, бързи промени в bypass кода |
| Неспазване на GDPR при tracking | Високо | Средно | Explicit consent banner, data deletion API |
| Голям обем телеметрични данни | Средно | Средно | Batch inserts, архивиране, retention политики |
| Лоша производителност на реклами | Средно | Средно | CDN за статични assets в продакшън, lazy-load |

## График / Основни етапи
| Етап | Целева дата | Отговорник |
|------|-------------|------------|
| Telemetry Service API + DB схема | Седмица 1 | Backend Dev |
| Basic Grafana dashboards | Седмица 1 | DevOps |
| Ads Service API + server-rendered шаблони | Седмица 2 | Backend Dev |
| Anti-adblocker механизми + A/B тест | Седмица 2 | Full-stack Dev |
| Дашборд за реклами (импресии/кликове) | Седмица 3 | DevOps |
| Тестове, CI и документация | Седмица 3 | QA / Dev |

> Оценена продължителност: **3 седмици**, минимално жизнеспособна платформа за анализи и реклами готова за локално тестване.

## i18n & L10n
- Всички UI низове (рекламни банери, dashboard) се извличат от преводни файлове
- API endpoint-ите приемат `Accept-Language` хедър
- Локализиране на дата/час във всички отчети

## SLO Targets (see `docs/observability/slo-sla.md`)
| Service | Metric | Target |
|---------|--------|--------|
| Telemetry API | Error rate | < 0.1 % |
| Ads delivery | 95th percentile latency | ≤ 500 ms |
