# 1.2: Миграции на базата данни

## Описание
Създаване и изпълнение на миграции за необходимите таблици в базата данни.

## Таблици
### users
- `id` UUID, първичен ключ
- `email` VARCHAR(255), уникален, не може да е NULL
- `password_hash` VARCHAR(255), не може да е NULL
- `first_name` VARCHAR(100), не може да е NULL
- `last_name` VARCHAR(100), не може да е NULL
- `status` ENUM('pending', 'active', 'suspended', 'deleted'), по подразбиране 'pending'
- `email_verified` BOOLEAN, по подразбиране FALSE
- `last_login_at` TIMESTAMP NULLABLE
- `created_at` TIMESTAMP
- `updated_at` TIMESTAMP
- `deleted_at` TIMESTAMP NULLABLE

### user_roles
- `user_id` UUID, външен ключ към users.id
- `role` VARCHAR(50), не може да е NULL
- `created_at` TIMESTAMP

### verification_tokens
- `id` UUID, първичен ключ
- `user_id` UUID, външен ключ
- `token` VARCHAR(255), не може да е NULL
- `type` ENUM('email_verification', 'password_reset')
- `expires_at` TIMESTAMP, не може да е NULL
- `used_at` TIMESTAMP NULLABLE
- `created_at` TIMESTAMP

### refresh_tokens
- `id` UUID, първичен ключ
- `user_id` UUID, външен ключ
- `token` VARCHAR(255), не може да е NULL
- `expires_at` TIMESTAMP, не може да е NULL
- `revoked` BOOLEAN, по подразбиране FALSE
- `created_at` TIMESTAMP
- `updated_at` TIMESTAMP

## Индекси
- Уникален индекс върху `users.email`
- Индекс върху `users.status` за бързо филтриране на потребители по статус
- Индекс върху `users.email_verified` за бързо намиране на потвърдени/непотвърдени акаунти
- Индекс върху `verification_tokens.token`
- Индекс върху `verification_tokens.user_id` за бързо намиране на токени за потребител
- Индекс върху `verification_tokens.type` за бързо търсене по тип токен
- Индекс върху `refresh_tokens.token`
- Индекс върху `refresh_tokens.user_id`
- Индекс върху `refresh_tokens.revoked` за бързо намиране на отнети токени
- Индекс върху `user_roles.role` за бързо търсене на потребители по роля

## Миграции
- Създаване на таблици
- Създаване на индекси
- Инициализиране на основни роли
- Добавяне на ограничения за чужд ключ

## Критерии за приемане
- [ ] Всички миграции се изпълняват успешно
- [ ] Всички таблици са създадени с правилните колони
- [ ] Индексите са създадени правилно
- [ ] Инициализирани са основните роли
- [ ] Тестовете за миграциите минават успешно

## Зависимости
- [AUTH-1-T0](AUTH-1-T0.md)
- [AUTH-1-T0.5](AUTH-1-T0.5.md) - Docker среда трябва да е пусната

## Свързани файлове
- `src/migrations/*`
- `src/entities/*`
- `test/migrations.spec.ts`

## Коментари
- Използвайте транзакции за всички миграции
- Осигурете възможност за връщане на промените (rollback)
- Тествайте миграциите в различни среди (dev, test, production)
