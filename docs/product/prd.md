# beelms – Product Requirements Document (PRD)

> Бележка: Този PRD описва **beelms core** като рамка. Конкретни инстанции, стъпили върху нея, имат собствени Product Brief и PRD извън този репозитори.

_Роля: PM (Product Manager). Фаза: BMAD Planning / Solutioning. Описва какви изисквания трябва да покрие продуктът за първата MVP версия._

## 1. Цел и обхват

Този PRD формализира **MVP изискванията** за **beelms core** като рамка (v1).
Целта е да даде единен списък от функционални области (FR) и ключови правила, които:

- се реализират като backend модули (NestJS) и референтен Next.js UI;
- имат ясно API покритие в `docs/architecture/openapi.yaml`;
- се проследяват към EPIC/STORY breakdown в `docs/backlog/beelms-core-epics-and-stories.md`.

**In scope (MVP v1):** FR-WIKI, FR-AUTH, FR-COURSES, FR-TASKS, FR-ASSESSMENTS, FR-ADMIN, FR-CROSS.

**Out of scope (за v1):** всички идеи, описани като post-MVP в `docs/product/post-mvp-backlog.md` и в Product Brief секциите „Out of Scope / Future Vision“.

Детайлите за поведение по екрани и UX сценарии **не се дублират** тук и са описани в:

- `docs/architecture/mvp-feature-list.md`
- `docs/ux-design-specification.md`

## 2. Потребители и таргет аудитория

Обобщение (детайли в Product Brief §2):
- Software / product екипи – изграждат собствена обучителна платформа върху beelms core.
- Training компании и академии – искат self-hosted / own-cloud LMS платформа, базирана на beelms.
- Freelance dev/consultants – използват beelms като база за клиентски решения.

Крайните обучаеми (студенти, специалисти и др.) не са директна таргет аудитория на рамката – те са потребители на конкретни инстанции, изградени върху beelms.

Роли в типична инстанция (детайли в `docs/architecture/beelms-core-architecture.md` → „Потребителски роли и права" и Product Brief §5.1):
- Администратор
- Потребител (регистриран)
- Гост (нерегистриран потребител)
- Teacher (преподавател)
- Content Author (автор на съдържание)
- Monitoring (наблюдение/метрики)

## 3. Бизнес цели (резюме)

Извлечени от Product Brief §1–4:
- Ускоряване на старта на LMS / training проекти чрез готов, разширяем core вместо „from scratch" имплементация.
- Повторна употреба на основни модули (auth, wiki, курсове, тестове, GDPR, интеграции) в множество инстанции.
- Възможност beelms да се използва в self-hosted / own-cloud сценарии с нисък стартов бюджет (Lean Tier 0).
- Минимизиране на усилието за поддръжка и ъпгрейд на core рамката при конкретни инстанции.

## 4. Функционални изисквания (FR)

Тук са описани основните функционални области на beelms core. Детайлизираното поведение по екрани и UX сценарии за MVP се описва в `docs/architecture/mvp-feature-list.md`.

### 4.1. Публична Wiki (FR-WIKI)

Обхват (MVP Feature List §1):
- Публичен списък със статии (търсене, филтриране по език).
- Екран „Wiki статия“ с превключване на език.

Ключови изисквания:
- FR-WIKI-1: Гост и регистриран потребител могат да преглеждат списък със статии без регистрация.
- FR-WIKI-2: Потребителят може да филтрира по език (напр. BG/EN) и да търси по заглавие/ключова дума.
- FR-WIKI-3: Екран „Wiki статия“ показва заглавие, съдържание и базова мета информация (последна редакция) и предоставя действия „Сподели“ (споделяне/копиране на линка към статията) и „Принтирай“ (отпечатване на съдържанието през браузъра).
- FR-WIKI-4: При налични езикови версии потребителят може да превключва между тях.
- FR-WIKI-5: Публичните Wiki екрани (списък и статия) показват само статии със статус `Active`. Статии в статус `Draft` или `Inactive` са достъпни и управляеми единствено през Admin панела.
- FR-WIKI-6: Wiki поддържа видимост `public` и `course_only`. Статии с `course_only` не са достъпни през публичните Wiki endpoints и се виждат само когато са част от курс и потребителят има достъп до курса.

API покритие:
- `GET /api/wiki/articles`
- `GET /api/wiki/articles/{slug}`

### 4.2. Акаунт и профил (FR-AUTH)

Обхват (MVP Feature List §2, Product Brief §5.2):
- Регистрация, вход/изход, забравена парола.
- Профил, закриване/изтриване на акаунта (единен потребителски flow, GDPR – right to be forgotten), експорт на лични данни.

Ключови изисквания:
- FR-AUTH-1: Регистрация с имейл и парола; валидация според минимални правила за сигурност.
- FR-AUTH-2: Вход с имейл и парола; издаване на JWT токен.
- FR-AUTH-3: Забравена парола – заявка и смяна чрез токен, валиден **24 часа**; при изтекъл/невалиден токен системата показва грешка на екрана Reset Password и изисква потребителят да подаде нова заявка през Forgot Password.
- FR-AUTH-4: Потребителят може да прегледа основна профилна информация (имейл, дата на регистрация).
- FR-AUTH-5: Потребителят може да закрие/изтрие акаунта си чрез единен flow (GDPR – right to be forgotten – окончателно изтриване/анонимизиране на личните данни, без възможност за възстановяване), с двустепенно потвърждение от страна на потребителя (два последователни диалога за потвърждение).
- FR-AUTH-6: Потребителят може да заяви експорт на личните си данни.
 - FR-AUTH-7: Anti-bot защита (напр. Google reCAPTCHA) при критични операции: регистрация, заявка за забравена парола, заявки за експорт на лични данни и (по избор) при вход след няколко последователни неуспешни опита.
- FR-AUTH-8: Системата прилага базов rate limiting за чувствителни email операции – напр. ограничение на броя успешни потвърждения на смяна на email за даден акаунт (примерно 3 потвърждения в рамките на 24 часа), като при достигане на лимита се връща справедливо съобщение за грешка и потребителят вижда кога ще може отново да заяви промяна.
- FR-AUTH-9: Социалните login-и (Google, Facebook, GitHub, LinkedIn) са контролирани чрез административни feature flags. Когато даден login е изключен, публичните authorize endpoints връщат `503` и фронтендът скрива/деактивира съответния бутон. Съществуващите акаунти, регистрирани чрез деактивирания доставчик, остават активни, но системата предлага fallback (имейл/парола или set-password flow), така че да няма silent lockout.

 API покритие (детайли в `docs/architecture/openapi.yaml`):
- `POST /api/auth/register`
- `POST /api/auth/login`
 - `POST /api/auth/forgot-password`
 - `POST /api/auth/reset-password`
 - `POST /api/auth/verify-email`
 - `GET /api/users/me`, `PATCH /api/users/me`, `DELETE /api/users/me`
 - `POST /api/users/me/export`, `POST /api/users/me/change-password`

### 4.3. Курсове и учебни пътеки (FR-COURSES)

 Обхват (MVP Feature List §6, Product Brief §5.2):
- Course Catalog и Course Detail.
- Enrollment в free курс и екран „My Courses“.
- Базов прогрес по курс (Not Started / In Progress / Completed).

Ключови изисквания:
- FR-COURSES-1: Гост може да преглежда списък с курсове (catalog) и детайл на курс.
- FR-COURSES-2: Регистриран потребител може да се запише (enroll) в free курс.
- FR-COURSES-2.1: Курс може да бъде `free` или `paid`. При `paid` курс опит за `enroll` връща `403 Payment required`.
- FR-COURSES-3: Записаният потребител вижда „My Courses“ с текущ статус на курса и базов прогрес.
- FR-COURSES-4: Course Detail показва подредена програма от модули (уроци/статии, задачи, quizzes).
- FR-COURSES-5: Course module items от тип Wiki могат да включват `course_only` статии. Потребител вижда `course_only` съдържание само ако е записан (enrolled) в съответния курс.

API покритие (планирано, детайли в `docs/architecture/openapi.yaml`):
- `GET /api/courses`
- `GET /api/courses/{courseId}`
- `POST /api/courses/{courseId}/enroll`
- `GET /api/users/me/courses`

### 4.4. Практически задачи (FR-TASKS)

Обхват (MVP Feature List §7):
- Course curriculum може да включва „task“ елементи с описание.
  - Потребителят може да маркира задача като изпълнена (completed) за целите на прогреса.
 
 Ключови изисквания:
- FR-TASKS-1: Курс може да съдържа задачи (task items) с title + описание.
 - FR-TASKS-2: Записаният потребител може да маркира задача като изпълнена.
 - FR-TASKS-3: За MVP задачите не изискват автоматично оценяване и не генерират advanced learning analytics (вж. FR-CROSS-3).
   
API покритие (планирано):
- `POST /api/courses/{courseId}/tasks/{taskId}/complete`

### 4.5. Базово оценяване / quizzes (FR-ASSESSMENTS)

Обхват (MVP Feature List §7, Product Brief §5.2):
- Прости quizzes (MCQ/single choice) като част от курс.
- Delivery на quiz и submit на отговори с резултат (score, pass/fail).

Ключови изисквания:
- FR-ASSESSMENTS-1: Курс може да включва quizzes към уроци/модули.
- FR-ASSESSMENTS-2: Записаният потребител може да зареди quiz, да подаде отговори и да получи резултат (score + pass/fail).
- FR-ASSESSMENTS-3: Системата записва резултата от опита (attempt) за нуждите на базов прогрес и история на потребителя.

API покритие (планирано):
- `GET /api/courses/{courseId}/quizzes/{quizId}`
- `POST /api/courses/{courseId}/quizzes/{quizId}/submit`

### 4.6. Администраторски панел (FR-ADMIN)

Обхват (MVP Feature List §4):
- Управление на Wiki съдържание и версии.
- Управление на курсове и quizzes (MVP ниво).
- Управление на потребители (активиране/деактивиране).
- Базово табло с метрики.

Ключови изисквания:
- FR-ADMIN-1: Админ може да създава, редактира и управлява статусите на Wiki статиите (Draft / Active / Inactive), включително деактивиране/скриване без окончателно изтриване, както и да качва и изтрива изображения, свързани с дадена статия, които се използват в markdown съдържанието.
- FR-ADMIN-2: Админ може да преглежда история на версиите на статия, да връща към предишна версия и да трие избрани стари версии.
- FR-ADMIN-3: Админ може да преглежда списък с потребители и да активира/деактивира акаунти.
 - FR-ADMIN-4: Админ табло показва базови метрики (поне брой регистрирани потребители).
 - FR-ADMIN-5: Админ може да управлява курсове (списък, създаване, редакция и статуси) и структурата им (модули: статии, задачи, quizzes).
- FR-ADMIN-6: Админ може да управлява базови quizzes (MCQ) и въпроси и да ги свързва към курсове.
- FR-ADMIN-7: В секция „Social Login Settings“ админът вижда отделни превключватели за Google, Facebook, GitHub и LinkedIn, индикация дали съответният доставчик е конфигуриран (env ключове) и промени се логват в audit trail. Изключването на даден доставчик взима ефект веднага за всички нови authorize опити.

API покритие (частично):
- `/api/admin/wiki/articles...`
- `/api/admin/wiki/articles/{id}/versions...`
- `/api/admin/courses...`
- `/api/admin/quizzes...`
- `/api/admin/users`, `/api/admin/users/{id}`
- `GET /api/admin/metrics/overview`

### 4.7. Cross-cutting функционалности (FR-CROSS)

Обхват (MVP Feature List §5, System Architecture – GDPR, Метрики, Безопасност):
- Мултиезичност в интерфейса и съдържанието.
- GDPR и управление на данни.
- Метрики и анализи.
- Безопасност.

Ключови изисквания (обобщени):
- FR-CROSS-1: Поддръжка на поне два езика в интерфейса (напр. BG и EN).
- FR-CROSS-2: Права по GDPR – достъп, изтриване, преносимост, корекция, плюс публична страница „Privacy/GDPR“ с обобщена информация за обработката на данни.
- FR-CROSS-3: Събиране на базови метрики за потребителско поведение и производителност на системата. Метрики за индивидуален учебен напредък (завършени задачи/exams) не са част от текущото MVP и ще се добавят в бъдещия „exams“ модул.
  - За текущото MVP минималното изискване за метрики е наличието на агрегирана стойност "брой регистрирани потребители", показвана в Admin Dashboard / Admin Metrics (виж FR-ADMIN-4 и mvp-feature-list §4.4). По-сложните агрегирани метрики (брой сесии, средна продължителност, разпределение по източник на трафик, периоди, export на данни и др.) са планирани като **post-MVP** функционалност и са описани в `docs/product/post-mvp-backlog.md` (MTX-POST-1).
- FR-CROSS-4: Основни защити – CSRF, XSS, SQL injection, защита срещу brute force атаки.
  - **CSRF стратегия**: За текущия Bearer token (JWT) модел CSRF защита е **N/A**, защото `Authorization` header-ът **не се изпраща автоматично** от браузъра към third-party origins. CORS + JWT guard осигуряват достатъчна защита. CSRF става релевантно при преминаване към cookie-based auth или `credentials: "include"`.
- FR-CROSS-5: Публични статични страници „About“ и „Contact", достъпни от footer-а на основните екрани.
- FR-LEGAL-1: Публична статична страница „Условия за ползване (Terms of Use)", достъпна от footer-а на основните екрани и от регистрационната форма (checkbox „Съгласен съм с условията за ползване и политиката за поверителност“).

## 5. Нефункционални изисквания (NFR)

Подробностите са описани основно в `docs/architecture/beelms-core-architecture.md`. Тук са събрани ключовите теми:

### 5.1. Производителност и мащабируемост

- NFR-1: Системата трябва да поддържа начално ниско натоварване на една VPS машина (описана в Product Brief §6.2 и System Architecture §Инфраструктура).
- NFR-2: Архитектурата трябва да позволява хоризонтално мащабиране на бекенд услугите при нужда.

### 5.2. Сигурност и GDPR

- NFR-3: Всички връзки са криптирани (HTTPS, TLS сертификати чрез Let's Encrypt).
- NFR-4: Личните данни се съхраняват и обработват съгласно GDPR (GDPR секция в System Architecture).
- NFR-5: JWT токени с разумен срок и механизъм за отнемане.

### 5.3. Наличност и надеждност

- NFR-6: Основните услуги (Wiki, Auth) трябва да бъдат проектирани така, че да се възстановяват бързо при рестарт на контейнерите.

### 5.4. UX и дизайн ограничения

- NFR-7: Цветова схема и стилистика, описани в Product Brief (зелено/червено като основни акценти).

## 6. Зависимости и интеграции

 Основни зависимости:
 - Next.js frontend приложение.
 - NestJS backend услуги (auth, wiki, metrics).
 - PostgreSQL и Redis.
 - RabbitMQ като message broker за асинхронни задачи и опашки.
 - Външна имейл услуга (за забравена парола и нотификации).

Интеграции (обобщени):
- Frontend ↔ API Gateway (REST/HTTPS).
- Метрики ↔ Prometheus/Grafana (в по-късна фаза от инфраструктурата).

## 7. Трейсабилност към други документи

- Product Brief – бизнес контекст и високониво функционален обхват.
- MVP Feature List – детайлно поведение по екрани/модули, което този PRD обобщава на ниво изисквания.
- System Architecture – технически решения, компоненти, NFR, сигурност, инфраструктура.
- OpenAPI спецификация – конкретни REST ендпойнти, които реализират описаните тук функционални изисквания.

Този PRD не дублира пълното съдържание на горните документи, а ги свързва и предоставя **единно място**, откъдето да се вижда какво трябва да прави продуктът, преди да се премине към епики, user stories и реална имплементация.
