# Роли и разрешения в системата

Този документ описва ролите в системата и тяхното взаимодействие, както и моделите на достъп и разрешения, свързани с тях.

## Съдържание

- [Основни роли](#основни-роли)
- [Разрешения](#разрешения)
- [Взаимодействие между ролите](#взаимодействие-между-ролите)
- [Имплементационни детайли](#имплементационни-детайли)
- [Бъдещи разширения](#бъдещи-разширения)

## Основни роли

### 1. Гост (Unauthenticated User)
- **Описание**: Потребител, който не е влязъл в системата
- **Достъп**: Ограничен до публични ресурси
- **Типични действия**:
  - Преглед на публична информация
  - Регистрация в системата
  - Вход в системата
  - Възстановяване на забравена парола

### 2. Студент (Student)
- **Описание**: Основен потребител на системата, който участва в курсове
- **Достъп**: Лични данни, курсове, в които е записан и тестове
- **Типични действия**:
  - Преглед на лична информация
  - Записване за курсове
  - Изпращане на тестове
  - Преглед на резултати и обратна връзка

### 3. Администратор (Administrator)
- **Описание**: Отговорник за управлението на системата
- **Достъп**: Пълен достъп до всички функционалности на системата
- **Типични действия**:
  - Управление на потребители (създаване, редактиране, деактивиране, изтриване)
  - Управление на курсове и учебни програми
  - Конфигуриране на системни настройки
  - Преглед на системни логове и метрики
  - Управление на роли и разрешения

## Разрешения

### Модел на достъп

Системата използва Role-Based Access Control (RBAC) модел, където:

1. **Ролите** дефинират набори от разрешения
2. **Потребителите** имат една или повече роли
3. **Ресурсите** имат дефинирани нива на достъп

### Матрица на разрешенията

| Ресурс | Гост | Студент | Администратор |
|--------|------|---------|--------------|
| Публична информация | Четене | Четене | Четене |
| Профил | - | Четене, Промяна, Изтриване | Четене, Промяна, Изтриване |
| Курсове (публични) | Четене | Четене | Четене, Създаване, Редактиране, Изтриване |
| Курсове (частни) | - | Четене (ако е записан) | Четене, Създаване, Редактиране, Изтриване |
| Тестове | - | Изпращане, Преглед (резултати) | Създаване, Редактиране, Преглед (всички) |
| Потребители | - | - | Управление |
| Системни настройки | - | - | Конфигуриране |

## Управление на акаунт

### Самоизтриване на акаунт

Всички потребители (с изключение на гостите) могат да изтрият собствения си акаунт:

1. **Процес на изтриване**:
   - Потребителят трябва да потвърди действието чрез въвеждане на паролата си
   - Системата изпраща имейл за потвърждение с линк за окончателно изтриване
   - След изтриване, акаунтът не може да бъде възстановен

2. **Последствия от изтриването**:
   - Всички лични данни се изтриват или анонимизират
   - Публичните съдържания (ако има такива) могат да бъдат запазени, но се маркират като анонимни
   - Изтриването е необратимо

3. **Изисквания за сигурност**:
   - Изисква се потвърждение чрез имейл
   - Необходима е валидна сесия
   - Изпраща се известие до администратора (ако е конфигурирано)

## Взаимодействие между ролите

### Студент ↔ Система
1. **Регистрация и аутентикация**
   - Гост се регистрира и получава роля "Студент"
   - След потвърждение на имейл, акаунтът става активен

2. **Участие в курсове**
   - Студент се записва за курс (ако е отворен за записване)
   - Получава достъп до материалите на курса

3. **Конфигурация**
   - Студент може да променя личните си данни, но с потвърждението чрез правилна парола
   - Студент може да изтрива собствения си акаунт

### Администратор ↔ Система
1. **Управление на потребители**
   - Създаване/редактиране на потребителски акаунти
   - Промяна на роли и разрешения
   - Деактивиране на акаунти

2. **Управление на курсове**
   - Създаване и конфигуриране на нови курсове
   - Назначаване на преподаватели и асистенти
   - Проследяване на напредъка на студентите

## Имплементационни детайли

### Защита на маршрути

```typescript
// Пример за използване на роли в NestJS контролер
@Controller('courses')
@UseGuards(JwtAuthGuard, RolesGuard)
export class CoursesController {
  constructor(private readonly coursesService: CoursesService) {}

  @Get()
  findAll() {
    return this.coursesService.findAll();
  }

  @Post()
  @Roles('admin')
  create(@Body() createCourseDto: CreateCourseDto) {
    return this.coursesService.create(createCourseDto);
  }
}
```

### Валидация на роли

Системата използва `RolesGuard` за валидиране на достъпа:

1. Проверява дали потребителят е аутентикиран (JWT токен)
2. Проверява дали потребителят има необходимите роли
3. Ако няма достъп, връща HTTP 403 Forbidden

## Заключение

Този документ предоставя общ преглед на ролите и разрешенията в системата. При необходимост от разширяване на функционалностите, трябва да се актуализира този документ, за да отразява промените в архитектурата на системата.
