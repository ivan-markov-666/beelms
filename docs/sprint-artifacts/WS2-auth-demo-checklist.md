# WS-2 Auth – Demo & Test Checklist

## 1. Scope и цели
- [ ] Този чеклист се отнася за WS-2 Auth walking skeleton-а:
  - Backend: `EPIC-WS2-AUTH-BE` (Auth API: register, login, forgot/reset, profile, delete, export).
  - Frontend: `EPIC-WS2-AUTH-FE` (Next.js екрани `/auth/*` и `/profile`).
- [ ] Цел: да се потвърди, че потребител може да:
  - [ ] създаде акаунт (register);
  - [ ] влезе в акаунта (login);
  - [ ] възстанови парола през сигурен forgot/reset flow;
  - [ ] види профила си;
  - [ ] изтрие акаунта (GDPR – right to be forgotten);
  - [ ] заяви експорт на личните си данни.

---

## 2. Предварителни условия (Environment, Data & Integrations)
- [ ] Backend (NestJS Auth/Users API) е стартиран и достъпен (напр. `http://localhost:3000`).
- [ ] Базата данни (PostgreSQL) е мигрирана с нужните таблици за потребители и Auth (User entity, токени и т.н.).
- [ ] Конфигуриран е JWT секрет и конфигурация за валидност на токените според System Architecture.
- [ ] Налична е поне dev интеграция с имейл услуга (реална или mock), така че forgot/reset flow да може да бъде демонстриран end-to-end.
- [ ] Конфигуриран е anti-bot механизъм (напр. reCAPTCHA) за критични операции (register, forgot-password, export), поне в една среда.
- [ ] Frontend приложението (Next.js) е стартирано и достъпно (напр. `http://localhost:3001`).

---

## 3. Backend – Регистрация и вход (`POST /api/auth/register`, `POST /api/auth/login`)
Източник: `STORY-WS2-BE-AUTH-REGISTER-LOGIN`

### 3.1 Регистрация
- [ ] `POST /api/auth/register` съществува и приема имейл и парола (и други полета според PRD/UX, ако има такива).
- [ ] При валидни данни:
  - [ ] се създава нов потребител в базата;
  - [ ] паролата се съхранява като **bcryptjs hash** (не в raw вид);
  - [ ] API връща `200 OK` (или `201`, според OpenAPI) с подходящ отговор.
- [ ] При вече зает имейл се връща подходящ код/съобщение (напр. `400`/`409`).
- [ ] При невалидни данни (лош имейл/парола) се връщат ясни validation грешки.
- [ ] Анти-bot защита е активна (reCAPTCHA/еквивалент) за заявката.

### 3.2 Вход
- [ ] `POST /api/auth/login` съществува и приема имейл и парола.
- [ ] При валидни креденшъли:
  - [ ] API връща `200 OK`;
  - [ ] връща JWT токен (и/или refresh token), според OpenAPI/архитектурата.
- [ ] При невалидни креденшъли:
  - [ ] API връща `401 Unauthorized`;
  - [ ] съобщението е общо („invalid credentials“), без да разкрива кое поле е грешно.
- [ ] При множество неуспешни опити (ако е в обхвата на WS-2) се активира защитен механизъм (напр. CAPTCHA или rate limiting).

---

## 4. Backend – Забравена и ресет парола (`POST /api/auth/forgot-password`, `POST /api/auth/reset-password`)
Източник: `STORY-WS2-BE-AUTH-FORGOT-RESET`

### 4.1 Forgot password
- [ ] `POST /api/auth/forgot-password` съществува и приема имейл адрес.
- [ ] При подаден имейл, ако съществува потребител:
  - [ ] се генерира криптографски сигурен reset токен с валидност (напр. 24 часа);
  - [ ] изпраща се имейл с линк/токен.
- [ ] Отговорът към клиента е успех (generic message), независимо дали имейл има в системата.
- [ ] Anti-bot защита (напр. reCAPTCHA) е активна за този endpoint.

### 4.2 Reset password
- [ ] `POST /api/auth/reset-password` съществува и приема токен + нова парола.
- [ ] При валиден и неизтекъл токен + валидна парола:
  - [ ] паролата се обновява (bcryptjs hash);
  - [ ] токенът става невалиден (еднократна употреба);
  - [ ] API връща `200 OK` и success съобщение.
- [ ] При невалиден/изтекъл токен API връща подходящ код (`400`/`410`) и общо съобщение; очаква се потребителят да подаде нова forgot заявка.

---

## 5. Backend – Профил, изтриване и експорт (`GET/DELETE/POST /api/users/me`)
Източник: `STORY-WS2-BE-AUTH-PROFILE-ACCOUNT`

### 5.1 Профил (`GET /api/users/me`)
- [ ] При валиден JWT токен endpoint-ът връща `200 OK` и основна информация (имейл, дата на регистрация и др. според PRD).
- [ ] При липсващ/невалиден токен се връща `401 Unauthorized`.

### 5.2 Изтриване на акаунт (`DELETE /api/users/me`)
- [ ] Изисква валиден JWT токен.
- [ ] При успешна заявка акаунтът и личните данни се изтриват/анонимизират (GDPR right to be forgotten).
- [ ] След изтриване старите токени на потребителя вече не работят.

### 5.3 Експорт на лични данни (`POST /api/users/me/export`)
- [ ] Изисква валиден JWT токен.
- [ ] При успех API подготвя данните и връща или директен файл, или информация за сваляне.
- [ ] Изисква anti-bot защита (reCAPTCHA/еквивалент), според PRD.

---

## 6. Frontend – Auth екрани: регистрация и вход
Източник: `STORY-WS2-FE-AUTH-REGISTER-LOGIN`

### 6.1 `/auth/register`
- [ ] Страницата показва форма за имейл, парола (и други полета според UX/PRD).
- [ ] Има механизъм за съгласие с Terms/Privacy (ако е описан в UX/PRD).
- [ ] Има client-side валидация (имейл формат, дължина на парола и др.).
- [ ] При success:
  - [ ] извиква `POST /api/auth/register`;
  - [ ] показва ясно съобщение за успех и/или пренасочва към login.
- [ ] При грешка показва подходящи съобщения, без да издава чувствителни детайли.

### 6.2 `/auth/login`
- [ ] Страницата показва форма за имейл и парола и линк към `/auth/forgot-password`.
- [ ] При success:
  - [ ] извиква `POST /api/auth/login`;
  - [ ] запазва токена и пренасочва към начална страница (напр. Wiki или dashboard).
- [ ] При грешка показва общо съобщение („Невалидни данни за вход“).

---

## 7. Frontend – Forgot & Reset Password екрани
Източник: `STORY-WS2-FE-AUTH-FORGOT-RESET`

### 7.1 `/auth/forgot-password`
- [ ] Форма за въвеждане на имейл + reCAPTCHA (или друг anti-bot UI).
- [ ] При submit извиква `POST /api/auth/forgot-password`.
- [ ] Показва общо success съобщение независимо дали имейлът съществува.

### 7.2 `/auth/reset-password`
- [ ] Страницата се отваря с токен (query/path параметър).
- [ ] Показва форма за нова парола (и потвърждение, ако UX го изисква).
- [ ] При submit извиква `POST /api/auth/reset-password`.
- [ ] При успех показва съобщение и/или пренасочва към `/auth/login`.
- [ ] При изтекъл/невалиден токен показва ясно съобщение и предлага да се подаде нова forgot заявка.

---

## 8. Frontend – Профил, изтриване и експорт
Източник: `STORY-WS2-FE-AUTH-PROFILE-ACCOUNT`

### 8.1 `/profile`
- [ ] Страницата е достъпна само за вписани потребители (guard/redirect към login при липса на токен).
- [ ] Показва информация от `GET /api/users/me` (имейл, дата на регистрация и др.).

### 8.2 Изтриване на акаунт
- [ ] Екранът предлага ясно обозначено действие за изтриване на акаунт.
- [ ] Реализирано е **двустепенно потвърждение** (два диалога/стъпки) преди реалното извикване на `DELETE /api/users/me`.
- [ ] При успех потребителят е изписан и вижда подходящо съобщение.

### 8.3 Експорт на данни
- [ ] Екранът предлага действие „Експорт на лични данни“.
- [ ] При заявка се вика `POST /api/users/me/export` (с нужните защити).
- [ ] При успех потребителят може да свали или получи данните си според договореното поведение.

---

## 9. Security, GDPR и UX проверки (cross-cutting)
- [ ] Никъде в логовете не се записват пароли или reset токени в raw вид.
- [ ] При грешки съобщенията в UI и API не разкриват дали конкретен имейл съществува в системата.
- [ ] Поведението при изтриване на акаунт е окончателно и съответства на GDPR (без опция за „undo").
- [ ] Документиран е поне базов поток за reCAPTCHA/anti-bot интеграция и rate limiting при чувствителни операции.

---

## 10. Тестове и дефекти
- [ ] BE: налични са поне базови unit/integration тестове за основните Auth/Users ендпойнти.
- [ ] FE: налични са базови FE/интеграционни тестове или ясен мануален чеклист за Auth & Profile екраните.
- [ ] Всички P0/P1 дефекти, свързани с WS-2 Auth BE/FE, са затворени преди демото.

---

## 11. Demo сценарий (high-level)
- [ ] Регистрация на нов потребител през `/auth/register` и потвърждение, че може да влезе през `/auth/login`.
- [ ] Демонстрация на неправилен login (грешно съобщение, без издаване на детайли).
- [ ] Forgot/reset flow: заявка през `/auth/forgot-password`, използване на токен/линк за `/auth/reset-password`, успех и последващ login.
- [ ] Показване на `/profile`, преглед на акаунта, демонстрация на експорт на лични данни.
- [ ] Демонстрация на изтриване на акаунт (двустепенно потвърждение) и последващ отказан достъп при опит за login.
