# STORY-WS2-FE-AUTH-EMAIL-VERIFICATION – FE UX за потвърждение на имейл (регистрация и смяна на имейл)

Status: Done

## Summary
Като **новорегистриран потребител** или **потребител, който сменя имейл адреса си**, искам **ясен UX flow за потвърждение на имейла**, така че да разбирам защо трябва да потвърдя адреса си и какво се случва, ако не го направя.

## Links to BMAD artifacts
- PRD – `docs/product/prd.md` (§4.2 FR-AUTH-1, FR-AUTH-4, §4.7 FR-CROSS-2).
- MVP Feature List – `docs/architecture/mvp-feature-list.md` (§2.1 Регистрация, §2.4 Профил и управление на акаунта).
- System Architecture – `docs/architecture/system-architecture.md` (GDPR, управление на данни, Имейл услуга, "Потвърждение по имейл преди изтриване").
- BE story – `docs/backlog/ws-2/stories/STORY-WS2-BE-AUTH-EMAIL-VERIFICATION.md`.

## Acceptance Criteria
- Регистрация:
  - След успешна регистрация потребителят вижда екран/съобщение, че трябва да потвърди имейла си чрез линк, изпратен по имейл.
  - Ако потребителят опита да използва функционалности, които изискват потвърден имейл (напр. бъдещи нотификации), без да е потвърдил имейла, UI го насочва да провери пощата си и/или да поиска нов verification имейл.
- Потвърждение на имейл:
  - При отваряне на verification линка (страница в FE, която вика BE endpoint за verify), потребителят вижда ясно съобщение:
    - при успех – че имейлът е потвърден и може да продължи да използва акаунта си (с ясно CTA към профила или екрана за вход според това дали вече е вписан);
    - при невалиден/изтекъл токен – общо съобщение за грешка с възможност да поиска нов verification имейл;
    - при сценарий, в който BE връща `429` за достигнат лимит на потвърждения при смяна на email, UI показва специфично съобщение за лимита и насочва потребителя към екрана „Моят профил“, където може да види повече детайли (вкл. кога лимитът ще бъде нулиран).
- Смяна на имейл:
  - След смяна на имейл през `/profile` UI показва, че е изпратен verification имейл към новия адрес и че промяната ще влезе в сила след потвърждение.
  - При успешно потвърждение на новия имейл (през verification линка) потребителят вижда съобщение, че основният му имейл е обновен.

## Dev Tasks
- [x] UX текстове за екрана/съобщението след регистрация ("Проверете имейла си...").
- [x] Страница/компонент за обработка на verification линка (напр. `/auth/verify-email?token=...`) – вика BE endpoint и показва съобщения за success/грешка.
- [x] Интеграция на FE с BE verify endpoint-а. Повторно изпращане на verification имейл е извън обхвата на WS-2 (няма BE endpoint за re-send) и остава за бъдещо разширение.
- [x] Обновяване на `/profile` екрана, така че да показва подходящи съобщения при смяна на имейл (изпратен verification линк, промяна след потвърждение).
- [x] FE тестове за основните сценарии (валиден verification линк, невалиден/изтекъл линк, липсващ токен, регистрация → съобщение за потвърждение).

## Test Scenarios
- **[FE-EMAIL-1] Регистрация и съобщение за потвърждение**
  - След успешна регистрация потребителят вижда съобщение, че трябва да потвърди имейла си.
- **[FE-EMAIL-2] Успешно потвърждение**
  - При валиден verification линк → UI показва съобщение за успех; при нужда пренасочва към login или профил.
- **[FE-EMAIL-3] Невалиден/изтекъл verification линк**
  - При отваряне на невалиден/изтекъл линк → UI показва общо съобщение за грешка и (по избор) действие за повторно изпращане на verification имейл.
- **[FE-EMAIL-4] Смяна на имейл + статут на верификация**
  - След смяна на имейл през `/profile` UI показва, че е изпратен verification имейл към новия адрес; след потвърждение – показва, че имейлът е обновен.
- **[FE-EMAIL-5] Лимит за потвърждение на смяна на имейл (429)**
  - При опит за потвърждение на нов email, когато BE връща `429 Too Many Requests` заради достигнат лимит (напр. 3 успешни потвърждения за 24 часа), UI показва ясно съобщение за лимита и насочва потребителя към профилния екран, вместо да показва обща техническа грешка.

## Notes
- Тази story зависи от `STORY-WS2-BE-AUTH-EMAIL-VERIFICATION` и не може да бъде финализирана преди BE endpoint-ите и токен логиката да са налични.
- Детайлите за това кои действия изискват потвърден имейл могат да се доуточнят в отделни stories (напр. нотификации, чувствителни операции) и да се маркират като post-MVP, ако е необходимо.
