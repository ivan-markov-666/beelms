# STORY-WS2-FE-AUTH-FORGOT-RESET – UI за забравена и ресет парола

Status: Done

## Summary
Като **регистриран потребител, който е забравил паролата си**, искам да имам **ясен флоу за заявка и ресет на паролата**, за да възстановя достъпа до акаунта си.

## Links to BMAD artifacts
- PRD – `docs/product/prd.md` (§4.2 FR-AUTH-3, FR-AUTH-7).
- MVP Feature List – `docs/architecture/mvp-feature-list.md` (§2.3 Забравена парола).
- UX Design – `docs/ux/qa4free-ux-design.md` (екрани за forgot/reset password).
- User Flows – `docs/ux/flows/qa4free-user-flows.md` (forgot/reset flow).
- System Architecture – `docs/architecture/system-architecture.md` (Auth, имейл услуга, security).
- MCP EPIC Map – `docs/backlog/MCP-EPIC-map.md` (EPIC-AUTH-ACCOUNTS, EPIC-CROSS-SECURITY).

## Acceptance Criteria
- Страница `/auth/forgot-password`:
  - Показва форма за въвеждане на имейл адрес.
  - Включва anti-bot елемент (напр. reCAPTCHA), в синхрон с PRD.
  - При изпращане се вика `POST /api/auth/forgot-password`.
  - UI показва общо съобщение за успех („Ако има акаунт с този имейл, ще изпратим инструкции…“), независимо дали има реален акаунт.
- Страница `/auth/reset-password`:
  - Достъпва се чрез линк с токен (напр. query или path параметър), получен по имейл.
  - Показва форма за нова парола (и потвърждение, ако UX го изисква).
  - При изпращане се вика `POST /api/auth/reset-password` с токен и нова парола.
  - При успех UI показва съобщение и/или пренасочва към `/auth/login`.
  - При изтекъл/невалиден токен UI показва подходящо съобщение и предлага да се подаде нова forgot заявка.
- Общи UX изисквания:
  - И двата екрана използват споделен layout и базови UI компоненти.
  - Съобщенията са на правилния език и съответстват на PRD/UX tone-of-voice.

## Dev Tasks
- [x] Имплементиране на страница `/auth/forgot-password` с форма, reCAPTCHA и интеграция с `POST /api/auth/forgot-password`.
- [x] Имплементиране на страница `/auth/reset-password` с форма за нова парола и интеграция с `POST /api/auth/reset-password`.
- [x] Обработка на различни състояния (успех, изтекъл токен, обща грешка) според UX/flows.
- [x] Ръчно тестване на целия forgot/reset флоу в комбинация с BE API.
- [x] FE тестове за основните сценарии и състояния.

## Test Scenarios

- **[FE-FR-1] Forgot – успешна заявка**
  - На `/auth/forgot-password` потребителят въвежда валиден email, преминава успешно CAPTCHA и натиска „Send reset link“.
  - Очакване: изпраща се заявка към `POST /api/auth/forgot-password`; при 200 UI показва общо success съобщение („Ако има акаунт с този имейл…“), без да издава дали акаунт съществува.

- **[FE-FR-2] Forgot – невалиден email / неподадена CAPTCHA**
  - Потребителят въвежда email с невалиден формат или не преминава CAPTCHA и натиска „Send reset link“.
  - Очакване: формата не изпраща заявка към backend; показват се подходящи validation/inline грешки (email формат, грешна/липсваща CAPTCHA).

- **[FE-FR-3] Reset – успешна смяна на парола**
  - На `/auth/reset-password?token=...` потребителят вижда форма за въвеждане на нова парола (и потвърждение, ако UX го изисква), въвежда валидна парола(и) и натиска „Change password“.
  - Очакване: изпраща се заявка към `POST /api/auth/reset-password` с токен и нова парола; при 200 UI скрива формата (или я инвалидира) и показва success състояние с линк към `/auth/login`.

- **[FE-FR-4] Reset – невалиден/изтекъл токен (BE връща 400/410)**
  - Потребителят отваря `/auth/reset-password` с невалиден или изтекъл токен, или опитва submit и получава 400/410.
  - Очакване: UI показва ясно съобщение за невалиден/изтекъл линк и предлага действие/линк да се върне към `/auth/forgot-password` за нова заявка.

- **[FE-FR-5] Reset – client-side validation грешки**
  - Въвеждане на пароли, които не съвпадат или не покриват минималните изисквания (напр. < 8 символа), и натискане на „Change password“.
  - Очакване: формата не изпраща заявка към backend; показват се локални съобщения под полетата (паролите не съвпадат, твърде къса парола и др.).

- **[FE-FR-6] Общa server-side грешка**
  - При Forgot или Reset backend връща неочаквана грешка (5xx/timeout).
  - Очакване: UI показва общо съобщение за грешка („Опитайте отново по-късно“), без технически детайли; формата остава достъпна за повторен опит.

## Notes
- Тази story стъпва директно върху `STORY-WS2-BE-AUTH-FORGOT-RESET` и трябва да следи неговия API contract.
- В dev среда линкът може да се „симулира“ (напр. да се показва в UI) докато не се включи реална имейл услуга, но за production флоу се очаква реален имейл.
- Важно е съобщенията да не издават дали даден имейл съществува в системата.
