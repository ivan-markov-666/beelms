# Auth API – примерни заявки\n\nТози документ съдържа примерни `curl` заявки за основните Auth endpoint-и на QA4Free.\n\n- Base URL (dev): `http://localhost:3000/api`\n- Всички заявки, които изискват токен, ползват Bearer JWT, издаден от `/auth/login`.\n\n> Забележка: Текстовете на грешките и точният отговор може да се различават леко от примерите тук – за authoritative дефиниция използвайте `docs/architecture/openapi.yaml`.\n\n---\n\n## 1. Регистрация – POST /auth/register\n\nСъздава нов потребител с роля `user`. При успех връща `UserProfile` без access token.\n\n```bash\ncurl -X POST \\\n  "http://localhost:3000/api/auth/register" \\\n  -H "Content-Type: application/json" \\\n  -d '{\n    "email": "new.user@example.com",\n    "password": "Aa!123456"\n  }'\n```\n\nПримерен 201 отговор (съкратен):\n\n```json\n{\n  "id": "f96b...",\n  "email": "new.user@example.com",\n  "role": "user",\n  "active": true,\n  "createdAt": "2025-01-10T09:30:00.000Z"\n}\n```\n\n---\n\n## 2. Вход – POST /auth/login\n\nВръща JWT token, който FE записва в `qa4free_access_token` в `localStorage`.\n\n```bash\ncurl -X POST \\\n  "http://localhost:3000/api/auth/login" \\\n  -H "Content-Type: application/json" \\\n  -d '{\n    "email": "new.user@example.com",\n    "password": "Aa!123456"\n  }'\n```\n\nПримерен 200 отговор:\n\n```json\n{\n  "accessToken": "<JWT_TOKEN>",\n  "expiresIn": 900\n}\n```\n\n---\n\n## 3. Профил на текущия потребител – GET /users/me\n\nТози endpoint се използва от FE (например `/profile`, Admin layout) за да зареди профилните данни и ролята на потребителя.\n\n```bash\ncurl -X GET \\\n  "http://localhost:3000/api/users/me" \\\n  -H "Authorization: Bearer <ACCESS_TOKEN>" \\\n  -H "Accept: application/json"\n```\n\nПримерен 200 отговор (съкратен):\n\n```json\n{\n  "id": "f96b...",\n  "email": "new.user@example.com",\n  "role": "admin",\n  "active": true,\n  "createdAt": "2025-01-10T09:30:00.000Z"\n}\n```\n\n---\n\n## 4. Forgot password – POST /auth/forgot-password\n\nИзползва се от страницата `/auth/forgot-password`.\nВ dev среда линкът за reset обикновено се логва в BE логовете или се изпраща през тестов mailing layer.\n\n```bash\ncurl -X POST \\\n  "http://localhost:3000/api/auth/forgot-password" \\\n  -H "Content-Type: application/json" \\\n  -d '{\n    "email": "existing.user@example.com"\n  }'\n```\n\n- При успех: `200` без тяло или с кратко съобщение.\n- При невалидни данни: `400`.\n\n---\n\n## 5. Reset password – POST /auth/reset-password\n\nReset линкът съдържа token (примерно `/auth/reset-password?token=...` на FE).\nСамият BE endpoint очаква JSON тяло с `token` и новата парола.\n\n```bash\ncurl -X POST \\\n  "http://localhost:3000/api/auth/reset-password" \\\n  -H "Content-Type: application/json" \\\n  -d '{\n    "token": "<RESET_TOKEN>",\n    "newPassword": "Bb!987654"\n  }'\n```\n\nВъзможни отговори:\n\n- `200` – паролата е сменена успешно.\n- `400` – невалиден или изтекъл token.\n\n---\n\n## 6. Verify email – POST /auth/verify-email\n\nПолзва се след регистрация или смяна на имейл. Линкът съдържа `token`, който FE праща към BE.\n\n```bash\ncurl -X POST \\\n  "http://localhost:3000/api/auth/verify-email" \\\n  -H "Content-Type: application/json" \\\n  -d '{\n    "token": "<VERIFY_TOKEN>"\n  }'\n```\n\n- `200` – имейлът е потвърден успешно.\n- `400` – невалиден/изтекъл verification token.\n\n---\n\n## 7. Примерен auth flow за тестове\n\n1. **Регистрирай** нов потребител чрез `/auth/register`.\n2. **Логни се** чрез `/auth/login` и вземи `accessToken`.\n3. За нуждите на dev/test:
   - Ако трябва да направиш потребителя admin, актуализирай ролята му през Admin Users UI или директно през БД (в dev).\n4. Използвай `accessToken` за:
   - `/users/me` – да потвърдиш, че ролята и статусът са правилни;\n   - Admin endpoint-и (напр. `/admin/wiki/...`, `/admin/metrics/overview`).\n\nЗа по-пълни детайли (всички полета, грешки и статус кодове) виж `docs/architecture/openapi.yaml` в секцията **Auth Service**.\n
